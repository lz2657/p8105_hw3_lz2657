---
title: "p8105_hw3_lz2657"
author: Lingyu Zhang
date: Oct 7, 2018
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::install_github("p8105/p8105.datasets", force = TRUE)
library(tidyverse)
library(readxl)
library(dplyr)
library(p8105.datasets)
library(ggplot2)
```

## Problem 1

First, read and manipulate the data as required.

```{r problem1_read_clean}
data("brfss_smart2010")
brfss_data = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  filter(response == "Excellent" | response =="Very good" | response == "Good" | response == "Fair" | response =="Poor")
brfss_data$response = factor(brfss_data$response, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))

brfss_data
```

Question 1:
```{r problem1_question1}
count_states_2002 = count(count(subset(brfss_data, year == 2002), locationabbr, locationdesc), locationabbr)
filter(count_states_2002, nn == 7)
```

In 2002, only CT, FL and NC were observed at 7 locations.

Question 2:
```{r problem1_question2, fig.width = 10, fig.height = 8}
count_states_year = count(count(brfss_data, year, locationabbr, locationdesc), year, locationabbr)

ggplot(data = count_states_year, aes(x = year, y = nn, colour = locationabbr)) +
labs(list(title = "year - number of locations", y = paste("number of locations"))) + 
geom_line(size=0.5)
```

Here is the required spaghetti plot and I enlarge the size of it to make it clearer.

Question 3:
```{r problem1_question3}
brfss_exclt_prop = subset(brfss_data, locationabbr == "NY" & response == "Excellent" & (year == 2002 | year == 2006 | year == 2010)) %>%
  group_by(year) %>%
  summarize(mean = mean(data_value), sd = sd(data_value))

brfss_exclt_prop
```

The mean of the proportion of "Excellent" doensn't have large changes while the sd of it was decreasing.

Question 4:
```{r problem1_question4, fig.width = 13}
brfss_prop = brfss_data %>%
  group_by(year, locationabbr, response) %>%
  summarize(mean = mean(data_value))
ggplot(subset(brfss_prop, !is.na(mean)), aes(x = year, y = mean, color = response)) + 
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ response)
```

The plot is shown above. The proportion of "Very good" is the highest and that of "Poor" is the lowest. All the proportions of the responses other than "Excellent" were almost unchange. The proportion of "Excellent" had decreased for about 2 percent during the period.